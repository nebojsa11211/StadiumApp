<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stadium Seating Map - Complete</title>
    
    <style>
        :root {
            /* Theme Variables */
            --primary-color: #2563eb;
            --accent-color: #059669;
            --background-color: #f8fafc;
            --pitch-color: #22c55e;
            --stroke-color: #64748b;
            --text-color: #1e293b;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --hover-glow: #3b82f6;
            --selected-color: #dc2626;
            
            /* Seat Colors */
            --seat-available: #10b981;
            --seat-selected: #dc2626;
            --seat-occupied: #6b7280;
            --seat-hover: #3b82f6;
            --seat-vip: #f59e0b;
            --seat-stroke: #374151;
            --seat-size: 16px;
        }

        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: var(--background-color);
            margin: 0;
            padding: 20px;
            color: var(--text-color);
        }

        .stadium-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px var(--shadow-color);
            overflow: hidden;
        }

        .stadium-header {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            padding: 20px;
            text-align: center;
        }

        .stadium-header h1 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .stadium-svg {
            width: 100%;
            height: auto;
            display: block;
            background: linear-gradient(135deg, #e2e8f0, #f1f5f9);
            animation: fadeInUp 0.6s ease-out;
        }

        /* Stadium Elements */
        .stadium-outline { fill: none; stroke: var(--stroke-color); stroke-width: 3; filter: drop-shadow(0 4px 8px var(--shadow-color)); }
        .pitch { fill: var(--pitch-color); stroke: #16a34a; stroke-width: 2; filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.15)); }
        .pitch-lines { stroke: #ffffff; stroke-width: 2; fill: none; opacity: 0.8; }

        /* Stand Groups */
        .stand-group {
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: center;
            animation: slideIn 0.4s ease-out both;
        }
        
        .stand-group:hover { transform: scale(1.02); filter: brightness(1.1) drop-shadow(0 4px 12px var(--hover-glow)); }
        .stand-group.selected { transform: scale(1.05); filter: brightness(1.2) drop-shadow(0 6px 16px var(--selected-color)); }
        .stand-tier { fill: url(#standGradient); stroke: var(--stroke-color); stroke-width: 1.5; opacity: 0.7; }
        .stand-group:hover .stand-tier { fill: var(--hover-glow); opacity: 0.8; }
        .stand-group.selected .stand-tier { fill: var(--selected-color); opacity: 0.9; }
        .stand-separator { stroke: #cbd5e1; stroke-width: 1; opacity: 0.6; }
        .stand-label { fill: white; font-family: system-ui, -apple-system, sans-serif; font-size: 14px; font-weight: 600; text-anchor: middle; dominant-baseline: middle; pointer-events: none; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5); }

        /* Individual Seats */
        .seat-group {
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            animation: seatAppear 0.3s ease-out both;
        }
        
        .seat-circle { stroke: var(--seat-stroke); stroke-width: 0.5; }
        .seat-group.available .seat-circle { fill: var(--seat-available); }
        .seat-group.selected .seat-circle { fill: var(--seat-selected); stroke: #991b1b; stroke-width: 1.5; }
        .seat-group.occupied .seat-circle { fill: var(--seat-occupied); }
        .seat-group.vip .seat-circle { fill: var(--seat-vip); stroke: #d97706; stroke-width: 1; }
        
        .seat-number {
            font-size: 12px;
            font-weight: 600;
            fill: white;
            text-anchor: middle;
            dominant-baseline: central;
            pointer-events: none;
            user-select: none;
        }

        .seat-group.selected { transform: scale(1.3); }
        .seat-group:not(.occupied):hover { transform: scale(1.1); filter: drop-shadow(0 2px 4px rgba(59, 130, 246, 0.4)); }
        .seat-group.occupied { pointer-events: none; }

        /* Controls */
        .stadium-controls {
            padding: 20px;
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }
        
        .control-button { background: var(--primary-color); color: white; border: none; padding: 10px 16px; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s; }
        .control-button:hover { background: #1d4ed8; transform: translateY(-1px); }
        .control-button.secondary { background: var(--accent-color); }
        .control-button.secondary:hover { background: #047857; }
        .seat-legend { display: flex; gap: 15px; align-items: center; font-size: 12px; margin-left: auto; }
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .legend-color { width: 12px; height: 12px; border-radius: 50%; border: 1px solid var(--seat-stroke); }

        /* Tooltip */
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            pointer-events: none;
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.2s, transform 0.2s;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            min-width: 100px;
            text-align: center;
        }
        
        .tooltip.visible { opacity: 1; transform: translateY(-5px); }
        .tooltip::after { content: ''; position: absolute; top: 100%; left: 50%; transform: translateX(-50%); border: 4px solid transparent; border-top-color: rgba(0, 0, 0, 0.9); }
        .tooltip .seat-info { font-size: 11px; opacity: 0.8; margin-top: 2px; }

        /* Animations */
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
        @keyframes seatAppear { from { opacity: 0; transform: scale(0); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body>

<div class="stadium-container">
    <div class="stadium-header">
        <h1>üèüÔ∏è Stadium Seating Map - Complete</h1>
    </div>

    <svg class="stadium-svg" viewBox="0 0 900 700" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Interactive stadium seating map">
        <defs>
            <radialGradient id="stadiumBg" cx="50%" cy="50%" r="70%">
                <stop offset="0%" style="stop-color:#f8fafc"/>
                <stop offset="100%" style="stop-color:#e2e8f0"/>
            </radialGradient>
            
            <linearGradient id="standGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#3b82f6"/>
                <stop offset="100%" style="stop-color:#1d4ed8"/>
            </linearGradient>
            
            <filter id="stadiumShadow">
                <feDropShadow dx="0" dy="4" stdDeviation="6" flood-opacity="0.15"/>
            </filter>
        </defs>

        <rect width="900" height="700" fill="url(#stadiumBg)"/>
        <ellipse cx="450" cy="350" rx="420" ry="320" class="stadium-outline" filter="url(#stadiumShadow)"/>
        <ellipse cx="450" cy="350" rx="360" ry="260" fill="none" stroke="#94a3b8" stroke-width="2" opacity="0.5"/>
        <rect x="350" y="250" width="200" height="200" rx="10" class="pitch"/>
        <g class="pitch-lines">
            <line x1="450" y1="250" x2="450" y2="450"/>
            <circle cx="450" cy="350" r="30" fill="none"/>
            <rect x="350" y="300" width="40" height="100" fill="none"/>
            <rect x="510" y="300" width="40" height="100" fill="none"/>
            <rect x="350" y="325" width="20" height="50" fill="none"/>
            <rect x="530" y="325" width="20" height="50" fill="none"/>
        </g>

        <g class="stand-group" data-sector="north" tabindex="0" role="button" aria-label="North stand section">
            <path d="M 100 80 Q 450 50 800 80 L 740 150 Q 450 120 160 150 Z" class="stand-tier"/>
            <path d="M 160 150 Q 450 120 740 150 L 680 190 Q 450 170 220 190 Z" class="stand-tier" style="opacity: 0.8"/>
            <line x1="350" y1="80" x2="320" y2="190" class="stand-separator"/>
            <line x1="550" y1="80" x2="580" y2="190" class="stand-separator"/>
            <text x="450" y="135" class="stand-label">NORTH</text>
        </g>
        
        <g class="stand-group" data-sector="south" tabindex="0" role="button" aria-label="South stand section">
            <path d="M 100 620 Q 450 650 800 620 L 740 550 Q 450 580 160 550 Z" class="stand-tier"/>
            <path d="M 160 550 Q 450 580 740 550 L 680 510 Q 450 530 220 510 Z" class="stand-tier" style="opacity: 0.8"/>
            <line x1="350" y1="620" x2="320" y2="510" class="stand-separator"/>
            <line x1="550" y1="620" x2="580" y2="510" class="stand-separator"/>
            <text x="450" y="565" class="stand-label">SOUTH</text>
        </g>

        <g class="stand-group" data-sector="east" tabindex="0" role="button" aria-label="East stand section">
            <path d="M 820 120 Q 850 350 820 580 L 750 520 Q 780 350 750 180 Z" class="stand-tier"/>
            <path d="M 750 180 Q 780 350 750 520 L 710 460 Q 730 350 710 240 Z" class="stand-tier" style="opacity: 0.8"/>
            <line x1="820" y1="270" x2="710" y2="290" class="stand-separator"/>
            <line x1="820" y1="430" x2="710" y2="410" class="stand-separator"/>
            <text x="765" y="350" class="stand-label">EAST</text>
        </g>

        <g class="stand-group" data-sector="west" tabindex="0" role="button" aria-label="West stand section">
            <path d="M 80 120 Q 50 350 80 580 L 150 520 Q 120 350 150 180 Z" class="stand-tier"/>
            <path d="M 150 180 Q 120 350 150 520 L 190 460 Q 170 350 190 240 Z" class="stand-tier" style="opacity: 0.8"/>
            <line x1="80" y1="270" x2="190" y2="290" class="stand-separator"/>
            <line x1="80" y1="430" x2="190" y2="410" class="stand-separator"/>
            <text x="135" y="350" class="stand-label">WEST</text>
        </g>
    </svg>

    <div class="stadium-controls">
        <button class="control-button" data-action="clear-all">Clear All</button>
        <button class="control-button" data-action="select-north">Select North</button>
        <button class="control-button secondary" data-action="select-seat">Select A01</button>
        <button class="control-button secondary" data-action="mark-occupied">Mark Occupied</button>
        <button class="control-button" data-action="export-png">Export PNG</button>
        
        <div class="seat-legend">
            <div class="legend-item">
                <div class="legend-color" style="background-color: var(--seat-available)"></div>
                <span>Available</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: var(--seat-selected)"></div>
                <span>Selected</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: var(--seat-occupied)"></div>
                <span>Occupied</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: var(--seat-vip)"></div>
                <span>VIP</span>
            </div>
        </div>
    </div>
</div>

<div class="tooltip" id="tooltip">
    <div class="tooltip-title"></div>
    <div class="seat-info"></div>
</div>

<script>
window.stadium = (function() {
    const svg = document.querySelector('.stadium-svg');
    const tooltip = document.getElementById('tooltip');
    const standGroups = document.querySelectorAll('.stand-group');
    const controls = document.querySelector('.stadium-controls');
    
    let selectedSectors = new Set();
    let selectedSeats = new Set();
    let seatStatuses = new Map();
    
    const sectorConfigs = {
        north: { rows: ['A', 'B'], seatsPerRow: 8, startX: 350, startY: 100, seatSpacingX: 35, seatSpacingY: 20, curvature: 0.15 },
        south: { rows: ['A', 'B'], seatsPerRow: 8, startX: 350, startY: 580, seatSpacingX: 35, seatSpacingY: -20, curvature: -0.15 },
        east: { rows: ['A', 'B'], seatsPerRow: 8, startX: 760, startY: 270, seatSpacingX: -20, seatSpacingY: 30, vertical: true },
        west: { rows: ['A', 'B'], seatsPerRow: 8, startX: 140, startY: 270, seatSpacingX: 20, seatSpacingY: 30, vertical: true }
    };

    function init() {
        generateAllSeats();
        setupEventListeners();
        console.log('Stadium initialized with', getTotalSeatCount(), 'seats');
    }

    function generateAllSeats() {
        Object.keys(sectorConfigs).forEach(sector => {
            generateSeats(sector);
        });
    }

    function generateSeats(sector) {
        const config = sectorConfigs[sector];
        const standGroup = document.querySelector(`[data-sector="${sector}"]`);
        if (!config || !standGroup) return;

        const seatsContainer = document.createElementNS('http://www.w3.org/2000/svg', 'g');
        seatsContainer.classList.add('seats-container');
        standGroup.appendChild(seatsContainer);

        config.rows.forEach((rowLetter, rowIndex) => {
            for (let seatIndex = 1; seatIndex <= config.seatsPerRow; seatIndex++) {
                const seatNumber = `${rowLetter}${seatIndex.toString().padStart(2, '0')}`;
                const seatGroup = createSeat(sector, seatNumber, rowIndex, seatIndex, config);
                
                seatGroup.setAttribute('data-seat-number', seatNumber);
                seatGroup.setAttribute('data-sector', sector);
                seatGroup.setAttribute('tabindex', '0');
                seatGroup.setAttribute('role', 'button');
                seatGroup.setAttribute('aria-label', `Seat ${seatNumber} in ${sector} section`);
                
                seatsContainer.appendChild(seatGroup);
                setSeatStatus(seatGroup, getRandomSeatStatus());
            }
        });
    }

    function createSeat(sector, seatNumber, rowIndex, seatIndex, config) {
        const seatGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
        seatGroup.classList.add('seat-group');

        let x, y;
        if (config.vertical) {
            x = config.startX + (rowIndex * config.seatSpacingX);
            y = config.startY + (seatIndex * config.seatSpacingY);
        } else {
            const baseX = config.startX + (seatIndex * config.seatSpacingX);
            const baseY = config.startY + (rowIndex * config.seatSpacingY);
            const curve = Math.pow(seatIndex - config.seatsPerRow / 2, 2) * config.curvature;
            x = baseX;
            y = baseY + curve;
        }

        const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
        circle.setAttribute('cx', x);
        circle.setAttribute('cy', y);
        circle.setAttribute('r', '18');
        circle.classList.add('seat-circle');

        const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        text.setAttribute('x', x);
        text.setAttribute('y', y);
        text.classList.add('seat-number');
        text.textContent = seatNumber;

        seatGroup.appendChild(circle);
        seatGroup.appendChild(text);

        // Event listeners
        seatGroup.addEventListener('mouseenter', (e) => showSeatTooltip(e, sector, seatNumber));
        seatGroup.addEventListener('mouseleave', hideTooltip);
        seatGroup.addEventListener('click', (e) => handleSeatClick(e, sector, seatNumber));
        seatGroup.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                handleSeatClick(e, sector, seatNumber);
            }
        });

        return seatGroup;
    }

    function setupEventListeners() {
        controls.addEventListener('click', handleControlClick);
        
        standGroups.forEach(group => {
            group.addEventListener('click', (e) => {
                if (e.target === group || e.target.classList.contains('stand-tier')) {
                    handleSectorClick(e, group.dataset.sector);
                }
            });
            
            group.addEventListener('mouseenter', (e) => {
                if (e.target === group || e.target.classList.contains('stand-tier')) {
                    showSectorTooltip(e, group.dataset.sector);
                }
            });
            
            group.addEventListener('mouseleave', (e) => {
                if (e.target === group) hideTooltip();
            });
        });

        svg.addEventListener('mousemove', updateTooltipPosition);
        svg.addEventListener('mouseleave', hideTooltip);
    }

    function handleControlClick(e) {
        const action = e.target.dataset.action;
        switch (action) {
            case 'clear-all': clearAllSelections(); break;
            case 'select-north': selectSector('north'); break;
            case 'select-seat': selectSeat('north', 'A01'); break;
            case 'mark-occupied': setSeatStatus(document.querySelector('[data-seat-number="B05"]'), 'occupied'); break;
            case 'export-png': exportAsPNG(); break;
        }
    }

    function handleSectorClick(e, sector) {
        e.stopPropagation();
        toggleSectorSelection(sector);
        
        const event = new CustomEvent('sectorSelected', {
            detail: { sector, selected: selectedSectors.has(sector) },
            bubbles: true
        });
        svg.dispatchEvent(event);
    }

    function handleSeatClick(e, sector, seatNumber) {
        e.stopPropagation();
        const seatGroup = e.currentTarget;
        
        if (seatGroup.classList.contains('occupied')) return;
        
        toggleSeatSelection(sector, seatNumber);
        
        const event = new CustomEvent('seatSelected', {
            detail: { sector, seatNumber, selected: selectedSeats.has(seatNumber) },
            bubbles: true
        });
        svg.dispatchEvent(event);
    }

    function showSectorTooltip(e, sector) {
        const name = sector.charAt(0).toUpperCase() + sector.slice(1);
        showTooltip(`${name} Stand`, 'Click to select section');
        updateTooltipPosition(e);
    }

    function showSeatTooltip(e, sector, seatNumber) {
        const seatGroup = e.currentTarget;
        const status = getSeatStatusFromElement(seatGroup);
        showTooltip(`Seat ${seatNumber}`, `Status: ${status}`);
        updateTooltipPosition(e);
    }

    function showTooltip(title, info = '') {
        const titleEl = tooltip.querySelector('.tooltip-title');
        const infoEl = tooltip.querySelector('.seat-info');
        titleEl.textContent = title;
        infoEl.textContent = info;
        tooltip.classList.add('visible');
    }

    function hideTooltip() {
        tooltip.classList.remove('visible');
    }

    function updateTooltipPosition(e) {
        if (!tooltip.classList.contains('visible')) return;
        const rect = svg.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        tooltip.style.left = (rect.left + x) + 'px';
        tooltip.style.top = (rect.top + y - 50) + 'px';
    }

    function toggleSectorSelection(sector) {
        const group = document.querySelector(`[data-sector="${sector}"]`);
        if (selectedSectors.has(sector)) {
            selectedSectors.delete(sector);
            group.classList.remove('selected');
        } else {
            selectedSectors.add(sector);
            group.classList.add('selected');
        }
    }

    function toggleSeatSelection(sector, seatNumber) {
        const seatGroup = document.querySelector(`[data-seat-number="${seatNumber}"]`);
        if (selectedSeats.has(seatNumber)) {
            selectedSeats.delete(seatNumber);
            seatGroup.classList.remove('selected');
        } else {
            selectedSeats.add(seatNumber);
            seatGroup.classList.add('selected');
        }
    }

    function selectSector(sector) {
        if (!selectedSectors.has(sector)) {
            toggleSectorSelection(sector);
        }
    }

    function selectSeat(sector, seatNumber) {
        const seatGroup = document.querySelector(`[data-seat-number="${seatNumber}"]`);
        if (seatGroup && !seatGroup.classList.contains('occupied') && !selectedSeats.has(seatNumber)) {
            toggleSeatSelection(sector, seatNumber);
            return true;
        }
        return false;
    }

    function setSeatStatus(seatElement, status) {
        if (!seatElement) return;
        seatElement.classList.remove('available', 'occupied', 'vip', 'selected');
        seatElement.classList.add(status);
        
        if (status === 'occupied') {
            const seatNumber = seatElement.dataset.seatNumber;
            selectedSeats.delete(seatNumber);
        }
    }

    function getSeatStatusFromElement(seatElement) {
        if (seatElement.classList.contains('occupied')) return 'Occupied';
        if (seatElement.classList.contains('vip')) return 'VIP';
        if (seatElement.classList.contains('selected')) return 'Selected';
        return 'Available';
    }

    function clearAllSelections() {
        selectedSectors.forEach(sector => {
            document.querySelector(`[data-sector="${sector}"]`).classList.remove('selected');
        });
        selectedSeats.forEach(seatNumber => {
            document.querySelector(`[data-seat-number="${seatNumber}"]`).classList.remove('selected');
        });
        selectedSectors.clear();
        selectedSeats.clear();
    }

    function getRandomSeatStatus() {
        const random = Math.random();
        if (random < 0.7) return 'available';
        if (random < 0.85) return 'occupied';
        return 'vip';
    }

    function getTotalSeatCount() {
        return Object.values(sectorConfigs).reduce((total, config) => 
            total + (config.rows.length * config.seatsPerRow), 0);
    }

    function exportAsPNG() {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const svgData = new XMLSerializer().serializeToString(svg);
        const img = new Image();
        const svgBlob = new Blob([svgData], {type: 'image/svg+xml;charset=utf-8'});
        const url = URL.createObjectURL(svgBlob);
        
        img.onload = function() {
            canvas.width = 900;
            canvas.height = 700;
            ctx.drawImage(img, 0, 0);
            URL.revokeObjectURL(url);
            
            const link = document.createElement('a');
            link.download = 'stadium-map.png';
            link.href = canvas.toDataURL();
            link.click();
        };
        img.src = url;
    }

    // Public API
    const api = {
        selectSector,
        selectSeat,
        clearAllSelections,
        setSeatStatus: (seatNumber, status) => {
            const el = document.querySelector(`[data-seat-number="${seatNumber}"]`);
            setSeatStatus(el, status);
        },
        getSelectedSectors: () => Array.from(selectedSectors),
        getSelectedSeats: () => Array.from(selectedSeats),
        getTotalSeatCount,
        exportAsPNG
    };

    // Initialize
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }

    return api;
})();

// Event listeners for testing
document.addEventListener('DOMContentLoaded', function() {
    document.querySelector('.stadium-svg').addEventListener('sectorSelected', e => 
        console.log('Sector selected:', e.detail));
    document.querySelector('.stadium-svg').addEventListener('seatSelected', e => 
        console.log('Seat selected:', e.detail));
});
</script>

</body>
</html>