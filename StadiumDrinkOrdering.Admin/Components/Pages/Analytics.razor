@page "/analytics"
@using StadiumDrinkOrdering.Admin.Components.Shared

<PageTitle>Analytics Dashboard</PageTitle>

<div class="analytics-dashboard" id="admin-analytics-container">
    <div class="admin-header" id="admin-analytics-header">
        <h1 id="admin-analytics-title">ðŸ“Š Analytics Dashboard</h1>
        <p id="admin-analytics-subtitle">Real-time insights and performance metrics for your stadium operations</p>
    </div>

    @if (_isLoading)
    {
        <div id="admin-analytics-loading">
            <LoadingSpinner IsVisible="true" Message="Loading analytics data..." Size="Large" />
        </div>
    }
    else
    {
        <!-- Key Performance Indicators -->
        <div class="stats-grid mb-6" id="admin-analytics-stats-grid">
            <div class="stat-card" id="admin-analytics-total-orders">
                <div class="stat-value" id="admin-analytics-orders-value">@_analytics.TotalOrders.ToString("N0")</div>
                <div class="stat-label" id="admin-analytics-orders-label">Total Orders</div>
                <div class="stat-trend @(_analytics.OrdersGrowth >= 0 ? "positive" : "negative")" id="admin-analytics-orders-trend">
                    <span class="trend-arrow" id="admin-analytics-orders-arrow">@(_analytics.OrdersGrowth >= 0 ? "â†—" : "â†˜")</span>
                    @(_analytics.OrdersGrowth.ToString("F1"))%
                </div>
            </div>

            <div class="stat-card success" id="admin-analytics-total-revenue">
                <div class="stat-value" id="admin-analytics-revenue-value">@_analytics.TotalRevenue.ToString("C")</div>
                <div class="stat-label" id="admin-analytics-revenue-label">Total Revenue</div>
                <div class="stat-trend @(_analytics.RevenueGrowth >= 0 ? "positive" : "negative")" id="admin-analytics-revenue-trend">
                    <span class="trend-arrow" id="admin-analytics-revenue-arrow">@(_analytics.RevenueGrowth >= 0 ? "â†—" : "â†˜")</span>
                    @(_analytics.RevenueGrowth.ToString("F1"))%
                </div>
            </div>

            <div class="stat-card info" id="admin-analytics-avg-order-value">
                <div class="stat-value" id="admin-analytics-aov-value">@_analytics.AvgOrderValue.ToString("C")</div>
                <div class="stat-label" id="admin-analytics-aov-label">Avg Order Value</div>
                <div class="stat-trend @(_analytics.AovGrowth >= 0 ? "positive" : "negative")" id="admin-analytics-aov-trend">
                    <span class="trend-arrow" id="admin-analytics-aov-arrow">@(_analytics.AovGrowth >= 0 ? "â†—" : "â†˜")</span>
                    @(_analytics.AovGrowth.ToString("F1"))%
                </div>
            </div>

            <div class="stat-card warning" id="admin-analytics-fulfillment-time">
                <div class="stat-value" id="admin-analytics-fulfillment-value">@_analytics.AvgFulfillmentTime</div>
                <div class="stat-label" id="admin-analytics-fulfillment-label">Avg Fulfillment Time</div>
                <div class="stat-trend @(_analytics.FulfillmentImprovement >= 0 ? "positive" : "negative")" id="admin-analytics-fulfillment-trend">
                    <span class="trend-arrow" id="admin-analytics-fulfillment-arrow">@(_analytics.FulfillmentImprovement >= 0 ? "â†—" : "â†˜")</span>
                    @(_analytics.FulfillmentImprovement.ToString("F1"))%
                </div>
            </div>
        </div>

        <div class="dashboard-grid" id="admin-analytics-dashboard-grid">
            <!-- Orders Over Time Chart -->
            <div class="chart-container" id="admin-analytics-orders-chart-container">
                <div class="chart-header" id="admin-analytics-orders-chart-header">
                    <h3 id="admin-analytics-orders-chart-title">Orders Over Time</h3>
                    <div class="chart-controls" id="admin-analytics-orders-chart-controls">
                        <select @bind="_selectedPeriod" @bind:after="LoadAnalytics" class="form-control form-control-sm" id="admin-analytics-period-select">
                            <option value="today">Today</option>
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                            <option value="quarter">This Quarter</option>
                        </select>
                    </div>
                </div>
                <div class="chart-body" id="admin-analytics-orders-chart-body">
                    <canvas id="ordersChart" width="400" height="200"></canvas>
                </div>
            </div>

            <!-- Revenue Chart -->
            <div class="chart-container" id="admin-analytics-revenue-chart-container">
                <div class="chart-header" id="admin-analytics-revenue-chart-header">
                    <h3 id="admin-analytics-revenue-chart-title">Revenue Analysis</h3>
                </div>
                <div class="chart-body" id="admin-analytics-revenue-chart-body">
                    <canvas id="revenueChart" width="400" height="200"></canvas>
                </div>
            </div>

            <!-- Popular Items -->
            <div class="chart-container" id="admin-analytics-popular-items-container">
                <div class="chart-header" id="admin-analytics-popular-items-header">
                    <h3 id="admin-analytics-popular-items-title">Popular Items</h3>
                </div>
                <div class="chart-body" id="admin-analytics-popular-items-body">
                    <div class="popular-items-list" id="admin-analytics-popular-items-list">
                        @foreach (var item in _analytics.PopularItems.Take(5))
                        {
                            <div class="popular-item" id="admin-analytics-popular-item-@item.Name.Replace(" ", "-").ToLower()">
                                <div class="item-info" id="admin-analytics-item-info-@item.Name.Replace(" ", "-").ToLower()">
                                    <div class="item-name" id="admin-analytics-item-name-@item.Name.Replace(" ", "-").ToLower()">@item.Name</div>
                                    <div class="item-count" id="admin-analytics-item-count-@item.Name.Replace(" ", "-").ToLower()">@item.OrderCount orders</div>
                                </div>
                                <div class="item-progress" id="admin-analytics-item-progress-@item.Name.Replace(" ", "-").ToLower()">
                                    <ProgressBar Value="@((double)item.OrderCount / _analytics.PopularItems.Max(x => x.OrderCount) * 100)" 
                                               Size="Small" 
                                               Color="primary" 
                                               ShowPercentage="false" 
                                               Animated="true" />
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <!-- Order Status Distribution -->
            <div class="chart-container" id="admin-analytics-status-chart-container">
                <div class="chart-header" id="admin-analytics-status-chart-header">
                    <h3 id="admin-analytics-status-chart-title">Order Status Distribution</h3>
                </div>
                <div class="chart-body" id="admin-analytics-status-chart-body">
                    <canvas id="statusChart" width="400" height="200"></canvas>
                </div>
            </div>

            <!-- Performance Metrics -->
            <div class="chart-container" id="admin-analytics-performance-container">
                <div class="chart-header" id="admin-analytics-performance-header">
                    <h3 id="admin-analytics-performance-title">Performance Metrics</h3>
                </div>
                <div class="chart-body" id="admin-analytics-performance-body">
                    <div class="performance-metrics" id="admin-analytics-performance-metrics">
                        <div class="metric" id="admin-analytics-customer-satisfaction">
                            <div class="metric-label" id="admin-analytics-satisfaction-label">Customer Satisfaction</div>
                            <div class="metric-value" id="admin-analytics-satisfaction-value">
                                <ProgressBar Value="@_analytics.CustomerSatisfaction" 
                                           Color="success" 
                                           Size="Medium" 
                                           Label="Rating" />
                            </div>
                        </div>

                        <div class="metric" id="admin-analytics-order-accuracy">
                            <div class="metric-label" id="admin-analytics-accuracy-label">Order Accuracy</div>
                            <div class="metric-value" id="admin-analytics-accuracy-value">
                                <ProgressBar Value="@_analytics.OrderAccuracy" 
                                           Color="primary" 
                                           Size="Medium" 
                                           Label="Accuracy" />
                            </div>
                        </div>

                        <div class="metric" id="admin-analytics-on-time-delivery">
                            <div class="metric-label" id="admin-analytics-delivery-label">On-Time Delivery</div>
                            <div class="metric-value" id="admin-analytics-delivery-value">
                                <ProgressBar Value="@_analytics.OnTimeDelivery" 
                                           Color="info" 
                                           Size="Medium" 
                                           Label="On Time" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Heat Map -->
            <div class="chart-container full-width" id="admin-analytics-heatmap-container">
                <div class="chart-header" id="admin-analytics-heatmap-header">
                    <h3 id="admin-analytics-heatmap-title">Stadium Activity Heat Map</h3>
                </div>
                <div class="chart-body" id="admin-analytics-heatmap-body">
                    <div class="heatmap-grid" id="admin-analytics-heatmap-grid">
                        @for (int section = 1; section <= 20; section++)
                        {
                            var activity = _analytics.SectionActivity.FirstOrDefault(s => s.SectionNumber == section)?.ActivityLevel ?? 0;
                            var intensity = activity / 100.0; // Normalize to 0-1
                            
                            <div class="heatmap-cell" 
                                 style="background-color: rgba(37, 99, 235, @intensity.ToString("F2", System.Globalization.CultureInfo.InvariantCulture))"
                                 id="@( $"admin-analytics-heatmap-section-{section}" )"
                                 title="Section @(section): @(activity)% activity">
                                <span class="section-number" id="@( $"admin-analytics-section-number-{section}" )">@(section)</span>
                                <span class="activity-level" id="@( $"admin-analytics-activity-level-{section}" )">@(activity)%</span>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- Real-time Updates -->
        <div class="realtime-section" id="admin-analytics-realtime-section">
            <div class="card" id="admin-analytics-realtime-card">
                <div class="card-header" id="admin-analytics-realtime-header">
                    <h3 id="admin-analytics-realtime-title">Real-Time Activity</h3>
                    <div class="realtime-indicator" id="admin-analytics-realtime-indicator">
                        <span class="indicator-dot" id="admin-analytics-indicator-dot"></span>
                        Live
                    </div>
                </div>
                <div class="card-body" id="admin-analytics-realtime-body">
                    <div class="activity-feed" id="admin-analytics-activity-feed">
                        @foreach (var activity in _realtimeActivities.Take(10))
                        {
                            <div class="activity-item fade-in" id="admin-analytics-activity-item-@activity.Timestamp.Ticks">
                                <div class="activity-time" id="admin-analytics-activity-time-@activity.Timestamp.Ticks">@activity.Timestamp.ToString("HH:mm:ss")</div>
                                <div class="activity-message" id="admin-analytics-activity-message-@activity.Timestamp.Ticks">@activity.Message</div>
                                <div class="activity-type @activity.Type.ToLower()" id="admin-analytics-activity-type-@activity.Timestamp.Ticks">@activity.Type</div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    }
</div>

